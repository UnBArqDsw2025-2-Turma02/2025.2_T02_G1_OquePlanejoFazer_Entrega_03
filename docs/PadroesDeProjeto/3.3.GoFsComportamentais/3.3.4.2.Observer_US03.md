# Observer
Continua√ß√£o do [3.3.4.1.Observer_US14-US15](https://unbarqdsw2025-2-turma02.github.io/2025.2_T02_G1_OquePlanejoFazer_Entrega_03/#/PadroesDeProjeto/3.3.GoFsComportamentais/3.3.4.1.Observer_US14-US15)

#### Identifica√ß√£o do candidato ideal

Com base na arquitetura do projeto "O que planejo fazer", foi identificado o seguinte componente que se beneficiaria do padr√£o Observer:

*   **Notifica√ß√µes de Prioriza√ß√£o de Tarefa** Quando uma Tarefa for colocado como Urgente, o usu√°rio e quaisquer pessoas que estejam conectadas a esta tarefa ser√£o notificados.

#### Fluxo de Funcionamento
1. Usu√°rio clica em Super Priorizar tarefa 
2. Alerta no frontend para o usu√°rio que disparou a a√ß√£o e em background para os demais na lista de observers.
3. Os observers executam suas a√ß√µes espec√≠ficas independentemente

### Implementa√ß√£o (Node.js)

**Back-end (Node.js - Notifica√ß√µes de Registro de Novo Usu√°rio)**

Este exemplo demonstra como o padr√£o Observer pode ser usado para gerar um alerta de prioriza√ß√£o de tarefa.

```javascript
class TaskObserverClass {
  constructor() {
    this.subscribers = [];
  }

  subscribe(fn) {
    this.subscribers.push(fn);
  }

  unsubscribe(fn) {
    this.subscribers = this.subscribers.filter((f) => f !== fn);
  }

  notify(task) {
    this.subscribers.forEach((fn) => fn(task));
  }
}

export const taskObserver = new TaskObserverClass();

```
**Front-end (React - Acionamento do Evento)**
No front-end, o componente PriorityTriggerButtn √© o ponto de contato que aciona o evento de prioriza√ß√£o. Uma vez que a requisi√ß√£o PUT √© bem-sucedida, o back-end (onde o Observer est√° implementado) √© respons√°vel por notificar os observadores.

```javascript
import React, { useEffect } from "react";
import { useTriggerPriorityTask } from "../hooks/useTriggerPriorityTask";
import { taskObserver } from "../observers/TaskObserver";

export function PriorityTriggerButton({ taskId }) {
  const { triggerTask, loading, error } = useTriggerPriorityTask();

  useEffect(() => {
    const handleTaskUpdated = (task) => {
      alert(`üö® Task ${task._id} is now SUPER PRIORIDADE!`);
    };

    taskObserver.subscribe(handleTaskUpdated);
    return () => taskObserver.unsubscribe(handleTaskUpdated);
  }, []);

  return (
    <div>
      <h1>Bot√£o de Aumentar Prioridade</h1>
      <button onClick={() => triggerTask(taskId)} disabled={loading}>
        {loading ? "Updating..." : "Make SUPER PRIORIDADE"}
      </button>
      {error && <p style={{ color: "red" }}>Error: {error}</p>}

      <div style={{ padding: 20 }}>
        
        
      </div>
    </div>
  );
}
```
Exemplo de uso no controller:

```javascript
import { taskObserver } from "../../../frontend/src/observers/TaskObserver.js";
import { Tarefa } from "../models/Tarefa.js";

export async function triggerPriorityChange(req, res) {
  try {
    const { id } = req.params;

    // Find the task by ID
    const task = await Tarefa.findById(id);
    if (!task) return res.status(404).json({ error: "Task not found" });

    // Update its priority to SUPER PRIORIDADE
    task.prioridade = "SUPER PRIORIDADE";
    await task.save();

    // Notify observer
    taskObserver.notify(task);

    return res.status(200).json(task);
  } catch (err) {
    console.error(err);
    return res.status(500).json({ error: "Failed to update task priority" });
  }
}

```

Como testar (prioriza√ß√£o):
- Rodar o backend (`npm run dev`).
- Executar:

```bash
curl -X PUT http://localhost:3333/api/tarefas/:id/trigger-priority
```

Resultados esperados:
- Resposta JSON confirmando cria√ß√£o.
- Alerta na janela do browser;
- Mudan√ßa refletida nas `tarefas` do MongoDB.

---

### Resultado Final

A capacidade de gerar notifica√ß√£o sobre a prioriza√ß√£o de tarefas.

## V√≠deo Explicativo
[V√≠deo Observer](https://youtu.be/XkqHGz475H4)

## Justificativa de Uso

* O **Observer** para Notifica√ß√µes de Atualiza√ß√£o de Tarefas (Node.js + React) permite que diferentes m√≥dulos (como a interface do usu√°rio, servi√ßo de logs ou sistema de alertas) reajam de forma independente quando uma tarefa muda de prioridade. Isso evita que o m√≥dulo respons√°vel pela atualiza√ß√£o da tarefa precise conhecer diretamente todos os componentes interessados, reduzindo o acoplamento e facilitando a expans√£o do sistema com novos comportamentos ap√≥s a atualiza√ß√£o.

* O padr√£o Observer √© ideal para cen√°rios em que um objeto precisa notificar v√°rios outros sobre mudan√ßas de estado ‚Äî como o caso de uma tarefa que se torna ‚ÄúSUPER PRIORIDADE‚Äù ‚Äî sem depender de refer√™ncias diretas a esses objetos. Essa abordagem promove escalabilidade e manutenibilidade, permitindo adicionar novos observadores (como notifica√ß√µes em tempo real ou dashboards) sem modificar o c√≥digo do sujeito que gera o evento.

## Hist√≥rico de Vers√µes
| Vers√£o | Altera√ß√£o | Respons√°vel | Data | Revisor |  Detalhes da Revis√£o | Data da Revis√£o |
|--------|-----------|-------------|------|---------|----------------------|-----------------|
| 1.0 | Adi√ß√£o do Observer usado na US03 | [Daniel Coimbra](https://github.com/DanielCoimbra) | 24/10/2025 | [SEU NOME](https://github.com/SEUGIT) | - |XX/XX/XXXX  |
